<!DOCTYPE html>
<html>
<head>
    <title>Test Organization Validation</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .border-warning {
            border-color: #ffc107 !important;
            border-width: 2px !important;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1>Test Organization Name Validation</h1>
        <p>Try entering existing member names like "Entrust", "Sectigo", "Keyfactor", etc.</p>

        <div class="col-12">
            <label for="organization" class="form-label">Organization Name</label>
            <input type="text" class="form-control" id="organization" name="Organization" aria-describedby="organizationHelp" required>
            <div id="organizationHelp" class="form-text">Please note that <strong>individual applications are rarely accepted</strong>.</div>
        </div>
    </div>

    <script>
        // Test version with hardcoded member list
        const existingMembers = [
            '3key company',
            'accutive security',
            'acubed',
            'airbus',
            'anf ac',
            'aprio',
            'ascertia',
            'baker tilly',
            'bloombase',
            'buypass',
            'calm',
            'cerene vera cruz',
            'certipath',
            'chunkworks',
            'cleverbase',
            'codegic',
            'comsign',
            'creaplus',
            'cryptas',
            'data warehouse',
            'david group',
            'directtrust',
            'dtrust',
            'ecac',
            'entrust',
            'eval',
            'firma profesional',
            'garantir',
            'harica',
            'i4p informatics',
            'keyfactor',
            'keytalk',
            'sectigo',
            'globalsign'
        ];

        const organizationInput = document.getElementById('organization');
        const organizationHelp = document.getElementById('organizationHelp');

        // Create a warning element for duplicate organization
        const warningDiv = document.createElement('div');
        warningDiv.id = 'organizationWarning';
        warningDiv.className = 'form-text text-warning fw-bold';
        warningDiv.style.display = 'none';
        organizationHelp.parentNode.insertBefore(warningDiv, organizationHelp.nextSibling);

        organizationInput.addEventListener('blur', function() {
            const orgName = this.value.toLowerCase().trim();

            if (orgName && existingMembers.length > 0) {
                const isDuplicate = existingMembers.some(member => {
                    return member === orgName ||
                           member.includes(orgName) ||
                           orgName.includes(member);
                });

                if (isDuplicate) {
                    warningDiv.textContent = '⚠️ Warning: An organization with a similar name is already a member of the PKI Consortium. If this is your organization, please contact us at members@pkic.org instead of submitting a new application.';
                    warningDiv.style.display = 'block';
                    organizationInput.classList.add('border-warning');
                } else {
                    warningDiv.style.display = 'none';
                    organizationInput.classList.remove('border-warning');
                }
            }
        });

        let debounceTimer;
        organizationInput.addEventListener('input', function() {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => {
                const orgName = this.value.toLowerCase().trim();

                if (orgName && existingMembers.length > 0) {
                    const isDuplicate = existingMembers.some(member => {
                        return member === orgName ||
                               member.includes(orgName) ||
                               orgName.includes(member);
                    });

                    if (isDuplicate) {
                        warningDiv.textContent = '⚠️ Warning: An organization with a similar name is already a member of the PKI Consortium. If this is your organization, please contact us at members@pkic.org instead of submitting a new application.';
                        warningDiv.style.display = 'block';
                        organizationInput.classList.add('border-warning');
                    } else {
                        warningDiv.style.display = 'none';
                        organizationInput.classList.remove('border-warning');
                    }
                }
            }, 500);
        });
    </script>
</body>
</html>
