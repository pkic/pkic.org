{{ define "main" }}
{{- $wgID := .Params.wgID | upper -}}
{{- $color := .Params.color | default "green" -}}
{{- $cardGrads := dict
  "blue"   "135deg, #08152e, #0d2452"
  "green"  "135deg, #0a1f14, #0d3d24"
  "orange" "135deg, #1e0c05, #3d1a08"
  "purple" "135deg, #110820, #2a0d3d"
  "teal"   "135deg, #051d1d, #0b3838"
  "red"    "135deg, #200808, #3d0d0d"
-}}
{{- $cardGrad := index $cardGrads $color | default "135deg, #0a1f14, #0d3d24" -}}

{{/* Hero */}}
{{ partial "hero.html" . }}

{{/* WG colour accent strip */}}
<div class="wg-hero-strip wg-{{ .Params.wgID | lower }}"></div>

{{/* Intro + CTA — only when there's something meaningful to show */}}
{{ if or .Params.intro .Content .Params.chair }}
<section class="py-5">
  <div class="container">
    <div class="row align-items-start g-4">
      <div class="col-lg-8">
        {{ with .Params.intro }}
          <p class="lead fs-5">{{ . | markdownify }}</p>
        {{ end }}
        {{ .Content }}
      </div>
      <div class="col-lg-4 text-center text-lg-end">
        {{ with .Params.chair }}
        <div class="mb-3 p-3 rounded-3 pkic-leadership-card" style="background: linear-gradient({{ $cardGrad }});">
          <div class="small text-uppercase fw-bold mb-1 pkic-leadership-label">Leadership</div>
          <div class="fw-semibold">{{ .name }}</div>
          <div class="small opacity-75">Chair</div>
          {{ with .viceChair }}
          <hr class="my-2 opacity-25">
          <div class="fw-semibold">{{ . }}</div>
          <div class="small opacity-75">Vice-Chair</div>
          {{ end }}
        </div>
        {{ end }}
        {{ with $.Param "heroButton" }}
        <a href="{{ $.Param "heroButton.link" }}" class="btn btn-success btn-lg rounded-pill px-4">
          {{ $.Param "heroButton.label" }}
        </a>
        {{ else }}
        <a href="/join/" class="btn btn-success btn-lg rounded-pill px-4">Join this Working Group</a>
        {{ end }}
        <div class="mt-2">
          <a href="./charter/" class="btn btn-outline-secondary btn-sm rounded-pill">View Charter</a>
        </div>
      </div>
    </div>
  </div>
</section>
{{ end }}

{{/* Focus Areas */}}
{{ with .Params.focus }}
<section class="py-5 wg-alt-section">
  <div class="container">
    <h2 class="fw-bold mb-1">Focus Areas</h2>
    <p class="text-muted mb-4">What this working group focuses on</p>
    <div class="bento-grid">
      {{ range . }}
      <div class="bento-card bento-{{ $color }}-pale">
        {{ with .icon }}<span class="bento-icon">{{ . }}</span>{{ end }}
        <div class="bento-title">{{ .title }}</div>
        <div class="bento-text">{{ .description }}</div>
      </div>
      {{ end }}
    </div>
  </div>
</section>
{{ end }}

{{/* Current Deliverables / Work items */}}
{{ with .Params.deliverables }}
<section class="py-5">
  <div class="container">
    <h2 class="fw-bold mb-1">What We're Working On</h2>
    <p class="text-muted mb-4">Current and planned deliverables of this working group</p>
    <div class="bento-grid">
      {{ range . }}
      {{ $statusColor := "green-pale" }}
      {{ if eq .status "planned" }}{{ $statusColor = "yellow-pale" }}{{ end }}
      {{ if eq .status "completed" }}{{ $statusColor = "blue-pale" }}{{ end }}
      <div class="bento-card">
        <span class="bento-badge bg-{{ if eq .status "active" }}success{{ else if eq .status "planned" }}warning text-dark{{ else }}info{{ end }}">
          {{ .status | default "active" }}
        </span>
        <div class="bento-title">{{ .title }}</div>
        <div class="bento-text">{{ .description }}</div>
        {{ with .url }}
        <div class="bento-footer">
          <a href="{{ . }}" class="stretched-link text-decoration-none text-success fw-semibold">Explore →</a>
        </div>
        {{ end }}
      </div>
      {{ end }}
    </div>
  </div>
</section>
{{ end }}

{{/* Members in this WG */}}
{{ with $wgID }}
<section class="py-5">
  <div class="container">
    <h2 class="fw-bold mb-1">Working Group Members</h2>
    <p class="text-muted mb-4">
      Organizations actively participating in the {{ $.Title }}
    </p>
    <div class="members-grid">
      {{/* Build a slice of members in this WG first */}}
      {{- $wgMembers := slice -}}
      {{- range hugo.Data.members -}}
        {{- if in .workingGroups $wgID -}}
          {{- $wgMembers = $wgMembers | append . -}}
        {{- end -}}
      {{- end -}}
      {{- range (shuffle $wgMembers) -}}
        {{- partial "member-card.html" (dict "member" . "site" $.Site "showDescription" false "showWorkingGroups" false "showSocialHover" true) -}}
      {{- end -}}
    </div>
    <div class="text-center mt-4">
      <a href="/members/" class="btn btn-outline-success rounded-pill">View All Members</a>
    </div>
  </div>
</section>
{{ end }}

{{/* Resources */}}
{{ with .Params.resources }}
<section class="py-5">
  <div class="container">
    <h2 class="fw-bold mb-1">Industry Resources</h2>
    <p class="text-muted mb-4">Useful references and external resources</p>
    <div class="bento-grid">
      {{ range . }}
      <a class="bento-card bento-card-link text-decoration-none" href="{{ .url }}" target="_blank" rel="noopener noreferrer">
        <div class="bento-title">{{ .title }}</div>
        <div class="bento-text">{{ .description }}</div>
        <div class="bento-footer text-success">Visit ↗</div>
      </a>
      {{ end }}
    </div>
  </div>
</section>
{{ end }}

{{/* Related blog posts */}}
{{ $blogPages := where .Site.RegularPages "Type" "blog" }}
{{ $wgTag := .Params.wgID | lower }}
{{ $relatedPosts := slice }}
{{ range $blogPages }}
  {{ $tags := .Params.tags | default slice }}
  {{ if or (in $tags $wgTag) (in $tags "pqc") (in $tags "post-quantum") (in $tags "quantum") }}
    {{ $relatedPosts = $relatedPosts | append . }}
  {{ end }}
{{ end }}
{{ if gt (len $relatedPosts) 0 }}
<section class="py-5 wg-alt-section">
  <div class="container">
    <h2 class="fw-bold mb-4">From the Blog</h2>
    <div class="row g-3">
      {{ range first 3 (sort $relatedPosts "Date" "desc") }}
      <div class="col-md-4">
        {{ partial "pagelisting.html" . }}
      </div>
      {{ end }}
    </div>
    <div class="text-center mt-3">
      <a href="/blog/" class="btn btn-outline-success rounded-pill">More on the Blog</a>
    </div>
  </div>
</section>
{{ end }}

{{/* Sub-pages (charter, etc.) */}}
{{ $subPages := where .Data.Pages "Params.robots" "eq" nil }}
{{ if $subPages }}
<section class="py-4">
  <div class="container">
    <h3 class="fw-bold mb-3">More from this Working Group</h3>
    <div class="row g-3">
      {{ range $subPages }}
      <div class="col-sm-6 col-md-4">
        <a href="{{ .Permalink }}" class="bento-card bento-card-link d-block text-decoration-none" style="min-height:120px;">
          <div class="bento-title">{{ .Title }}</div>
          <div class="bento-text">{{ .Summary }}</div>
        </a>
      </div>
      {{ end }}
    </div>
  </div>
</section>
{{ end }}

{{/* Join CTA */}}
<section class="py-5">
  <div class="container">
    <div class="pkic-cta-block bento-{{ $color }} text-white">
      <div class="pkic-cta-title">Join the {{ .Title }}</div>
      <p class="pkic-cta-text">
        Membership in the PKI Consortium working groups is open to all member types.
        Collaborate with industry leaders, shape standards, and drive meaningful change.
      </p>
      <a href="/join/" class="btn btn-light btn-lg rounded-pill px-5 fw-bold">Become a Member</a>
      <a href="/discussions/" class="btn btn-outline-light btn-lg rounded-pill px-4 ms-2">Join Discussions</a>
    </div>
  </div>
</section>

{{ end }}
