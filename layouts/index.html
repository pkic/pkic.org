{{ define "main" }}

{{/* ─── Hero ─────────────────────────────────────────────────────────── */}}
<section class="pkic-home-hero">
  <div class="container py-5">
    <div class="row align-items-center gy-4">
      <div class="col-lg-7">
        <p class="text-uppercase fw-bold small mb-2 opacity-75" style="letter-spacing: 0.16em;">{{ $.Param "heroHeader" }}</p>
        <h1 class="display-4 fw-bold lh-sm mb-3">{{ $.Param "heroTitle" }}</h1>
        <p class="lead mb-4" style="max-width:540px;">{{ $.Param "heroDescription" }}</p>
        <div class="d-flex flex-wrap gap-3">
          <a href="/about/" class="btn btn-pkic btn-lg px-4">Learn more</a>
          <a href="/join/" class="btn btn-pkic-outline btn-lg px-4">Join the Consortium</a>
        </div>
      </div>
      {{ $featuredPost := first 1 (where .Site.RegularPages "Type" "blog") }}
      {{ with index $featuredPost 0 }}
      <div class="col-lg-5 d-none d-lg-block">
        <a href="{{ .Permalink }}" class="pkic-hero-post-card text-decoration-none d-block">
          <p class="pkic-hero-post-label">Latest News</p>
          <h3 class="pkic-hero-post-title">{{ .Title }}</h3>
          <time class="pkic-hero-post-date" datetime="{{ .PublishDate.Format "2006-01-02" }}">{{ .PublishDate | time.Format ":date_long" }}</time>
          <p class="pkic-hero-post-summary">{{ .Summary | truncate 140 }}</p>
          <span class="pkic-hero-post-cta">Read more &rarr;</span>
        </a>
      </div>
      {{ end }}
    </div>
  </div>
</section>

{{/* ─── Stats bar ───────────────────────────────────────────────────── */}}
{{ $memberCount := len hugo.Data.members }}
{{/* Only count top-level, non-draft working group sections */}}
{{ $wgSections := where .Site.Pages "Section" "wg" }}
{{ $wgCount := 0 }}
{{ range $wgSections }}
  {{ if and (eq .Kind "section") (eq .Parent.RelPermalink "/wg/") (not .Draft) }}
    {{ $wgCount = add $wgCount 1 }}
  {{ end }}
{{ end }}
<div class="pkic-stats-bar">
  <div class="container">
    <div class="row g-0 text-center">
      <div class="col">
        <div class="pkic-stat"><span class="pkic-stat-num">{{ $memberCount }}</span><span class="pkic-stat-label">Members</span></div>
      </div>
      <div class="col">
        <div class="pkic-stat"><span class="pkic-stat-num">~1K</span><span class="pkic-stat-label">Representatives</span></div>
      </div>
      <div class="col">
        <div class="pkic-stat"><span class="pkic-stat-num">{{ $wgCount }}</span><span class="pkic-stat-label">Working Groups</span></div>
      </div>
      <div class="col d-none d-sm-block">
        <div class="pkic-stat"><span class="pkic-stat-num">Free</span><span class="pkic-stat-label">to Join</span></div>
      </div>
    </div>
  </div>
</div>

{{/* ─── Alert banner (from _index.md content) ────────────────────── */}}
{{ if .Content }}
<div class="container pt-4 pb-2" data-pagefind-ignore>
  {{ .Content }}
</div>
{{ end }}

{{/* ─── Members logo wall ─────────────────────────────────────────────── */}}
<div class="pkic-section-label"><span>Our Members &amp; Sponsors</span></div>
{{ .Scratch.Set "date" "" }}
{{ .Scratch.Set "limit" "80" }}
<section class="members-overview">
  <div class="container-fluid px-2 px-md-3 py-4 text-center members">
    {{ partial "members.html" . }}
  </div>
</section>

{{/* ─── Working Groups spotlight ──────────────────────────────────── */}}
{{/* Collect WG section pages that have .Params.card, sorted by card.order */}}
{{ $wgSections := where .Site.Pages "Section" "wg" }}
{{ $wgCards := slice }}
{{ range $wgSections }}
  {{ if and (eq .Kind "section") (ne .RelPermalink "/wg/") .Params.card }}
    {{ $wgCards = $wgCards | append . }}
  {{ end }}
{{ end }}
{{ $wgCards = sort $wgCards "Params.card.order" }}

<section class="pkic-wg-section py-5">
  <div class="container">
    <div class="d-flex align-items-end justify-content-between mb-4 pb-1">
      <div>
        <h2 class="h3 fw-bold mb-0">Working Groups</h2>
      </div>
      <a href="/wg/" class="btn btn-sm btn-outline-secondary flex-shrink-0">All working groups &rarr;</a>
    </div>
    <div class="row g-4">
      {{ range $wgCards }}
      <div class="col-sm-6 col-xl-3">
        {{ partial "wg-spotlight-card.html" . }}
      </div>
      {{ end }}
    </div>
  </div>
</section>

{{/* ─── Recent blog posts ─────────────────────────────────────────────── */}}
{{ $posts := first 3 (where .Site.RegularPages "Type" "blog") }}
{{ if $posts }}
<section class="pkic-recent-posts py-5" style="background:#fff; position:relative; z-index:1;">
  <div class="container">
    <div class="d-flex align-items-baseline justify-content-between mb-4">
      <h2 class="h3 fw-bold mb-0">Latest from the Blog</h2>
      <a href="/blog/" class="btn btn-sm btn-outline-secondary">All posts &rarr;</a>
    </div>
    <div class="row g-4 align-items-start">
      {{ range $posts }}
      <div class="col-md-4">
        {{ partial "blog-card.html" . }}
      </div>
      {{ end }}
    </div>
  </div>
</section>
{{ end }}

{{/* ─── Join CTA ────────────────────────────────────────────────────── */}}
<section class="pkic-join-cta">
  <div class="container text-center">
    <h2 class="fw-bold mb-3">Become a Member</h2>
    <p class="lead mb-4 mx-auto" style="max-width:560px;">The PKI Consortium is open to organizations committed to improving trust in digital assets and communications. Membership is free.</p>
    <a href="/join/" class="btn btn-light btn-lg rounded-pill px-5 fw-bold">Join today &mdash; it&rsquo;s free</a>
  </div>
</section>

{{ end }}